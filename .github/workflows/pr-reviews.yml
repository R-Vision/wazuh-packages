name: pr-review
on: 
  pull_request:
    branches: [ 'poc-shellcheck-to4.3', 'master' ]

jobs:
  get-files:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2.1.0
      - name: Get Files
        uses: jitterbit/get-changed-files@v1
        id: changed_files
        with:
          format: 'csv'
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Create tools file
        run: echo '{\"data\":[' > tools.json
      - name: Display changed files cert_tool
        if: contains(steps.changed_files.outputs.all, 'cert_tool')
        run: echo '{\"tool\":\"cert-tool\"}' >> tools.json
      - name: Display changed files passwords_tool
        if: contains(steps.changed_files.outputs.all, 'passwords_tool')
        run: echo ',{\"tool\":\"passwords-tool\"}' >> tools.json
      - name: Finish file
        run: echo ']}' >> tools.json
      - name: Build Matrix
        id: set-matrix
        run: |
          echo "::set-output name=tools_matrix::$(cat tools.json)"
      - name: cat json
        run: echo ${{ steps.set-matrix.outputs.tools_matrix }}
    outputs:
      tools_matrix: ${{ steps.set-matrix.outputs.tools_matrix }}
  
  Builder-Scripts:
    runs-on: ubuntu-latest
    needs: get-files
    strategy:
      matrix: ${{fromJson(needs.get-files.outputs.tools_matrix)}}
    steps:
      - name: builder-sh
        run: echo ${{ matrix.data.tool }}
