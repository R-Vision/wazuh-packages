name: pr-review
on: 
  pull_request:
    branches: [ 'poc-shellcheck-to4.3', 'master' ]

jobs:
  get-files:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2.1.0
      - name: Get Files
        uses: jitterbit/get-changed-files@v1
        id: changed_files
        with:
          format: 'csv'
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Create tools file
        run: echo '\{\\\"data\\\":[' > tools.json
      - name: Display changed files cert_tool
        if: contains(steps.changed_files.outputs.all, 'cert_tool')
        run: echo '{\\\"tool\\\":\\\"cert-tool\\\"}' >> tools.json
      - name: Display changed files passwords_tool
        if: contains(steps.changed_files.outputs.all, 'passwords_tool')
        run: echo ',{\\\"tool\\\":\\\"passwords-tool\\\"}' >> tools.json
      - name: Finish file
        run: echo ']\}' >> tools.json
      - name: set cert
        if: contains(steps.changed_files.outputs.all, 'cert_tool')
        run: |
          echo 'VAR=cert_tool' >> $GITHUB_ENV
      - name: set password
        if: contains(steps.changed_files.outputs.all, 'passwords_tool')
        run: |
          echo 'VAR=passwords_tool' >> $GITHUB_ENV
      - name: Build Matrix
        id: set-matrix
        run: |
          TASKS=$(echo $(cat tools.json)| sed 's/ //g' )
          echo "::set-output name=tools_matrix::${TASKS}"
      - name: cat json
        run: echo ${{ steps.set-matrix.outputs.tools_matrix }}
      - name: echo json
        run: echo "${{ env.VAR }}
    outputs:
      tools_matrix: ${{ steps.set-matrix.outputs.tools_matrix }}
  
  Builder-Scripts:
    runs-on: ubuntu-latest
    needs: get-files
    strategy:
      matrix: ${{fromJson(needs.get-files.outputs.tools_matrix)}}
    steps:
      - name: builder-sh
        run: echo ${{ matrix.data.tool }}
